<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Get GeoJSON</title>
    <meta http-equiv="cleartype" content="on">
    <link rel="stylesheet" href="//scraperwiki.com/vendor/style/bootstrap.min.css">
    <link rel="stylesheet" href="//scraperwiki.com/style/scraperwiki.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
    <script src="//scraperwiki.com/vendor/js/bootstrap.min.js"></script>
    <script src="//scraperwiki.com/js/scraperwiki.js"></script>
    <script>
      function loadSettings(callback) {
        scraperwiki.tool.exec('touch allSettings.json; cat allSettings.json',
          function(content) {
            if(content) {
              try {
                window.allSettings = JSON.parse(content)
              } catch(e) {
                smart_alert("Failed to parse settings file",
                  String(e), "\n\n" + content)
              }
            }
            callback()
          })
      }
      function populateForm() {
        // :todo(drj): abstract list of identifiers to populate.
        $('#source').val(window.allSettings.source)
      }

      $(function() {
          loadSettings(populateForm)

          // Setup the "submit" button.
          var execSuccess = function(execOutput) {
            var datasetUrl = "/dataset/" + scraperwiki.box
            scraperwiki.tool.redirect(datasetUrl)
          }
          $('#submit').on('click', function() {
            $(this).addClass('loading').html('Convertingâ€¦')
            var q = $('#source').val()
            scraperwiki.exec("tool/geojson.py " + scraperwiki.shellEscape(q),
              execSuccess)
            scraperwiki.tool.rename("GeoJSON from " + q)
          })
      })
    </script>
  </head>
  <body style="text-align: center">
    <h1>Enter GeoJSON URL</h1>
    <div class="input-append">
      <input type="text" name="source" size="80" id="source"
      placeholder="URL, eg: http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_day.geojson">
      <button class="btn btn-primary" type="submit" id="submit">Get Data</button>
    </div>
<script>
$(function(){
  $('#q').on('keypress', function(e){
    if(e.which == 13) {
      $('#submit').trigger('click')
    }
  })
})
</script>
  </body>
</html>
